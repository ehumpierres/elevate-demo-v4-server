[
    {
      "question": "What are our top 5 industries by total revenue?",
      "sql": "SELECT\n  INDUSTRY,\n  SUM(AMOUNT) AS total_revenue\nFROM\n  DEMO_V4.CORRELATED_SCHEMA.FINANCIAL_DATA\nWHERE\n  ACCOUNT_TYPE = 'Income'\nGROUP BY\n  INDUSTRY\nORDER BY\n  total_revenue DESC\nLIMIT 5;"
    },
    {
      "question": "What is the average won deal size for each customer type?",
      "sql": "SELECT\n  CUSTOMER_TYPE,\n  AVG(AMOUNT) AS average_deal_size\nFROM\n  DEMO_V4.CORRELATED_SCHEMA.OPPORTUNITIES\nWHERE\n  STATUS = 'Won'\nGROUP BY\n  CUSTOMER_TYPE\nORDER BY\n  average_deal_size DESC;"
    },
    {
      "question": "How many support tickets do we receive by priority level, and what's their average resolution time?",
      "sql": "SELECT\n  PRIORITY,\n  COUNT(*) AS ticket_count,\n  AVG(DATEDIFF('day', CREATED_DATE, UPDATED_DATE)) AS avg_resolution_days\nFROM\n  DEMO_V4.CORRELATED_SCHEMA.SUPPORT_TICKETS\nGROUP BY\n  PRIORITY\nORDER BY\n  CASE\n    WHEN PRIORITY = 'High' THEN 1\n    WHEN PRIORITY = 'Medium' THEN 2\n    WHEN PRIORITY = 'Low' THEN 3\n    ELSE 4\n  END;"
    },
    {
        "question": "Which lead sources generate the most closed-won opportunities and what's their success rate?",
        "sql": "SELECT\n  LEAD_SOURCE,\n  COUNT(*) AS total_opportunities,\n  COUNT(CASE WHEN STATUS = 'Won' THEN 1 END) AS won_opportunities,\n  ROUND(COUNT(CASE WHEN STATUS = 'Won' THEN 1 END) * 100.0 / COUNT(*), 2) AS win_rate\nFROM\n  DEMO_V4.CORRELATED_SCHEMA.OPPORTUNITIES\nGROUP BY\n  LEAD_SOURCE\nORDER BY\n  won_opportunities DESC;"
    },
    {
        "question": "What's our quarterly revenue trend over the past three years, including transaction count?",
        "sql": "SELECT\n  DATE_TRUNC('quarter', TRANSACTION_DATE) AS quarter,\n  SUM(AMOUNT) AS quarterly_revenue,\n  COUNT(*) AS transaction_count\nFROM\n  DEMO_V4.CORRELATED_SCHEMA.FINANCIAL_DATA\nWHERE\n  ACCOUNT_TYPE = 'Income'\n  AND TRANSACTION_DATE >= DATEADD('year', -3, CURRENT_DATE())\nGROUP BY\n  quarter\nORDER BY\n  quarter;"
    },
    {
      "question": "Which customers have the highest number of support tickets, and what's their financial value?",
      "sql": "SELECT\n  s.CUSTOMER_ID,\n  f.CUSTOMER_NAME,\n  f.INDUSTRY,\n  f.CUSTOMER_TYPE,\n  COUNT(s.TICKET_ID) AS ticket_count,\n  SUM(CASE WHEN f.ACCOUNT_TYPE = 'Income' THEN f.AMOUNT ELSE 0 END) AS total_revenue\nFROM\n  DEMO_V4.CORRELATED_SCHEMA.SUPPORT_TICKETS s\nJOIN\n  DEMO_V4.CORRELATED_SCHEMA.FINANCIAL_DATA f ON s.CUSTOMER_ID = f.CUSTOMER_ID\nGROUP BY\n  s.CUSTOMER_ID, f.CUSTOMER_NAME, f.INDUSTRY, f.CUSTOMER_TYPE\nORDER BY\n  ticket_count DESC\nLIMIT 10;"
    },
    {
      "question": "What is the average sales cycle duration (in days) for each industry?",
      "sql": "SELECT\n  INDUSTRY,\n  AVG(DATEDIFF('day', OPEN_DATE, CLOSE_DATE)) AS avg_sales_cycle_days\nFROM\n  DEMO_V4.CORRELATED_SCHEMA.OPPORTUNITIES\nWHERE\n  STATUS IN ('Won', 'Lost')\nGROUP BY\n  INDUSTRY\nORDER BY\n  avg_sales_cycle_days DESC;"
    },
    {
      "question": "How does our support ticket response time correlate with customer revenue?",
      "sql": "WITH customer_metrics AS (\n  SELECT\n    t.CUSTOMER_ID,\n    AVG(DATEDIFF('day', t.CREATED_DATE, t.UPDATED_DATE)) AS avg_resolution_days,\n    SUM(CASE WHEN f.ACCOUNT_TYPE = 'Income' THEN f.AMOUNT ELSE 0 END) AS total_revenue\n  FROM\n    DEMO_V4.CORRELATED_SCHEMA.SUPPORT_TICKETS t\n  JOIN\n    DEMO_V4.CORRELATED_SCHEMA.FINANCIAL_DATA f ON t.CUSTOMER_ID = f.CUSTOMER_ID\n  GROUP BY\n    t.CUSTOMER_ID\n)\n\nSELECT\n  CASE\n    WHEN avg_resolution_days < 1 THEN 'Same Day'\n    WHEN avg_resolution_days < 3 THEN '1-3 Days'\n    WHEN avg_resolution_days < 7 THEN '3-7 Days'\n    ELSE 'Over 7 Days'\n  END AS resolution_time_bucket,\n  COUNT(*) AS customer_count,\n  AVG(total_revenue) AS avg_revenue_per_customer\nFROM\n  customer_metrics\nGROUP BY\n  resolution_time_bucket\nORDER BY\n  CASE\n    WHEN resolution_time_bucket = 'Same Day' THEN 1\n    WHEN resolution_time_bucket = '1-3 Days' THEN 2\n    WHEN resolution_time_bucket = '3-7 Days' THEN 3\n    ELSE 4\n  END;"
    },
    {
      "question": "What is the customer lifecycle value across different segments, from initial opportunity to recurring transactions, and how do support experiences impact that journey?",
      "sql": "WITH customer_journey AS (\n  SELECT\n    f.CUSTOMER_ID,\n    f.CUSTOMER_NAME,\n    f.INDUSTRY,\n    f.CUSTOMER_TYPE,\n    MIN(o.OPEN_DATE) AS first_opportunity_date,\n    MIN(CASE WHEN o.STATUS = 'Closed Won' THEN o.CLOSE_DATE ELSE NULL END) AS first_win_date,\n    MIN(f.TRANSACTION_DATE) AS first_transaction_date,\n    MAX(f.TRANSACTION_DATE) AS last_transaction_date,\n    DATEDIFF('day', MIN(CASE WHEN o.STATUS = 'Closed Won' THEN o.CLOSE_DATE ELSE NULL END), MAX(f.TRANSACTION_DATE)) AS customer_tenure_days\n  FROM\n    DEMO_V4.CORRELATED_SCHEMA.FINANCIAL_DATA f\n  JOIN\n    DEMO_V4.CORRELATED_SCHEMA.OPPORTUNITIES o ON f.CUSTOMER_ID = o.CUSTOMER_ID\n  GROUP BY\n    f.CUSTOMER_ID, f.CUSTOMER_NAME, f.INDUSTRY, f.CUSTOMER_TYPE\n),\n\nfinancial_metrics AS (\n  SELECT\n    CUSTOMER_ID,\n    COUNT(*) AS total_transactions,\n    SUM(CASE WHEN ACCOUNT_TYPE = 'Income' THEN AMOUNT ELSE 0 END) AS total_revenue,\n    SUM(CASE WHEN ACCOUNT_TYPE = 'Expense' THEN AMOUNT ELSE 0 END) AS total_expenses,\n    SUM(CASE WHEN ACCOUNT_TYPE = 'Income' THEN AMOUNT ELSE 0 END) - SUM(CASE WHEN ACCOUNT_TYPE = 'Expense' THEN AMOUNT ELSE 0 END) AS net_value,\n    COUNT(DISTINCT DATE_TRUNC('month', TRANSACTION_DATE)) AS active_months\n  FROM\n    DEMO_V4.CORRELATED_SCHEMA.FINANCIAL_DATA\n  GROUP BY\n    CUSTOMER_ID\n),\n\nopportunity_metrics AS (\n  SELECT\n    CUSTOMER_ID,\n    COUNT(*) AS total_opportunities,\n    COUNT(CASE WHEN STATUS = 'Closed Won' THEN 1 END) AS won_opportunities,\n    SUM(CASE WHEN STATUS = 'Closed Won' THEN AMOUNT ELSE 0 END) AS total_opportunity_value,\n    ROUND(COUNT(CASE WHEN STATUS = 'Closed Won' THEN 1 END) * 100.0 / NULLIF(COUNT(*), 0), 2) AS win_rate\n  FROM\n    DEMO_V4.CORRELATED_SCHEMA.OPPORTUNITIES\n  GROUP BY\n    CUSTOMER_ID\n),\n\nsupport_metrics AS (\n  SELECT\n    CUSTOMER_ID,\n    COUNT(*) AS total_tickets,\n    COUNT(CASE WHEN PRIORITY IN ('High', 'Urgent', 'Critical') THEN 1 END) AS high_priority_tickets,\n    AVG(DATEDIFF('day', CREATED_DATE, UPDATED_DATE)) AS avg_resolution_time,\n    COUNT(CASE WHEN TICKET_STATUS IN ('Resolved', 'Closed') THEN 1 END) * 100.0 / NULLIF(COUNT(*), 0) AS resolution_rate\n  FROM\n    DEMO_V4.CORRELATED_SCHEMA.SUPPORT_TICKETS\n  GROUP BY\n    CUSTOMER_ID\n)\n\nSELECT\n  cj.CUSTOMER_ID,\n  cj.CUSTOMER_NAME,\n  cj.INDUSTRY,\n  cj.CUSTOMER_TYPE,\n  cj.first_opportunity_date,\n  cj.first_win_date,\n  cj.first_transaction_date,\n  cj.last_transaction_date,\n  cj.customer_tenure_days,\n  fm.total_transactions,\n  fm.total_revenue,\n  fm.total_expenses,\n  fm.net_value,\n  fm.active_months,\n  ROUND(fm.total_revenue / NULLIF(fm.active_months, 0), 2) AS monthly_revenue,\n  ROUND(fm.net_value / NULLIF(cj.customer_tenure_days, 0) * 30, 2) AS monthly_net_value,\n  om.total_opportunities,\n  om.won_opportunities,\n  om.win_rate,\n  om.total_opportunity_value,\n  sm.total_tickets,\n  sm.high_priority_tickets,\n  sm.avg_resolution_time,\n  sm.resolution_rate,\n  ROUND(fm.total_revenue / NULLIF(sm.total_tickets, 0), 2) AS revenue_per_ticket,\n  CASE\n    WHEN cj.customer_tenure_days > 365 THEN 'Long-term (>1 year)'\n    WHEN cj.customer_tenure_days > 180 THEN 'Medium-term (6-12 months)'\n    ELSE 'Short-term (<6 months)'\n  END AS tenure_segment\nFROM\n  customer_journey cj\nJOIN\n  financial_metrics fm ON cj.CUSTOMER_ID = fm.CUSTOMER_ID\nJOIN\n  opportunity_metrics om ON cj.CUSTOMER_ID = om.CUSTOMER_ID\nLEFT JOIN\n  support_metrics sm ON cj.CUSTOMER_ID = sm.CUSTOMER_ID\nORDER BY\n  monthly_net_value DESC, customer_tenure_days DESC;"
    },
    {
      "question": "How does the frequency and severity of support tickets correlate with customer financial value, and what is the impact on future transactions after ticket resolution?",
      "sql": "WITH customer_financials AS (\n  SELECT\n    CUSTOMER_ID,\n    SUM(CASE WHEN ACCOUNT_TYPE = 'Income' THEN AMOUNT ELSE 0 END) AS total_income,\n    COUNT(DISTINCT CASE WHEN ACCOUNT_TYPE = 'Income' THEN BALANCE_ID END) AS income_transaction_count,\n    AVG(CASE WHEN ACCOUNT_TYPE = 'Income' THEN AMOUNT ELSE NULL END) AS avg_income_value\n  FROM\n    DEMO_V4.CORRELATED_SCHEMA.FINANCIAL_DATA\n  GROUP BY\n    CUSTOMER_ID\n),\n\nticket_metrics AS (\n  SELECT\n    CUSTOMER_ID,\n    COUNT(*) AS total_tickets,\n    SUM(CASE WHEN PRIORITY IN ('High', 'Urgent', 'Critical') THEN 1 ELSE 0 END) AS high_priority_tickets,\n    AVG(DATEDIFF('day', CREATED_DATE, UPDATED_DATE)) AS avg_resolution_time,\n    MAX(UPDATED_DATE) AS last_ticket_date\n  FROM\n    DEMO_V4.CORRELATED_SCHEMA.SUPPORT_TICKETS\n  WHERE\n    TICKET_STATUS IN ('Resolved', 'Closed')\n  GROUP BY\n    CUSTOMER_ID\n),\n\npost_ticket_transactions AS (\n  SELECT\n    t.CUSTOMER_ID,\n    COUNT(*) AS post_ticket_transaction_count,\n    SUM(f.AMOUNT) AS post_ticket_revenue,\n    AVG(f.AMOUNT) AS avg_post_ticket_transaction_value\n  FROM\n    ticket_metrics t\n  JOIN\n    DEMO_V4.CORRELATED_SCHEMA.FINANCIAL_DATA f ON t.CUSTOMER_ID = f.CUSTOMER_ID\n  WHERE\n    f.ACCOUNT_TYPE = 'Income'\n    AND f.TRANSACTION_DATE > t.last_ticket_date\n  GROUP BY\n    t.CUSTOMER_ID\n)\n\nSELECT\n  cf.CUSTOMER_ID,\n  f.CUSTOMER_NAME,\n  f.INDUSTRY,\n  f.CUSTOMER_TYPE,\n  cf.total_income,\n  cf.income_transaction_count,\n  cf.avg_income_value,\n  tm.total_tickets,\n  tm.high_priority_tickets,\n  tm.avg_resolution_time,\n  ROUND(tm.total_tickets * 1.0 / cf.income_transaction_count, 4) AS tickets_per_transaction_ratio,\n  pt.post_ticket_transaction_count,\n  pt.post_ticket_revenue,\n  pt.avg_post_ticket_transaction_value,\n  ROUND((pt.avg_post_ticket_transaction_value - cf.avg_income_value) / cf.avg_income_value * 100, 2) AS transaction_value_change_pct\nFROM\n  customer_financials cf\nJOIN\n  DEMO_V4.CORRELATED_SCHEMA.FINANCIAL_DATA f ON cf.CUSTOMER_ID = f.CUSTOMER_ID\nJOIN\n  ticket_metrics tm ON cf.CUSTOMER_ID = tm.CUSTOMER_ID\nLEFT JOIN\n  post_ticket_transactions pt ON cf.CUSTOMER_ID = pt.CUSTOMER_ID\nGROUP BY\n  cf.CUSTOMER_ID, f.CUSTOMER_NAME, f.INDUSTRY, f.CUSTOMER_TYPE, cf.total_income, cf.income_transaction_count, cf.avg_income_value, tm.total_tickets, tm.high_priority_tickets, tm.avg_resolution_time, pt.post_ticket_transaction_count, pt.post_ticket_revenue, pt.avg_post_ticket_transaction_value\nORDER BY\n  transaction_value_change_pct DESC;"
    }
]